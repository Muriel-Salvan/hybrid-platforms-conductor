#!/usr/bin/env ruby
require 'range_operators'
require 'hybrid_platforms_conductor/nodes_handler'
require 'hybrid_platforms_conductor/logger_helpers'

include HybridPlatformsConductor::LoggerHelpers

nodes_handler = HybridPlatformsConductor::NodesHandler.new
veids = nodes_handler.
  known_hostnames.
  map do |hostname|
    conf = nodes_handler.site_meta_for hostname
    conf.key?('veid') ? conf['veid'].to_i : nil
  end.
  compact

out "Free VEIDs: #{([10_000] + veids).missing.rangify}"
