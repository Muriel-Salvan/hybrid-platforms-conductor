#!/usr/bin/env ruby
require 'hybrid_platforms_conductor/nodes_handler'
require 'hybrid_platforms_conductor/reports_handler'
require 'optparse'

hosts = []
nodes_handler = HybridPlatformsConductor::NodesHandler.new
reports_handler = HybridPlatformsConductor::ReportsHandler.new(nodes_handler: nodes_handler)
OptionParser.new do |opts|
  opts.banner = "Usage: #{$0} [options]"
  opts.separator ''
  opts.separator 'Main options:'
  opts.on('-h', '--help', 'Display help and exit') do
    puts opts
    exit 0
  end
  reports_handler.options_parse(opts)
  nodes_handler.options_parse(opts)
  nodes_handler.options_parse_hosts(opts, hosts)
end.parse!
reports_handler.validate_params
raise "Unknown options: #{ARGV.join(' ')}" unless ARGV.empty?

hosts << { all: true } if hosts.empty?

reports_handler.produce_report_for(nodes_handler.resolve_hosts(hosts))
