#!/usr/bin/env ruby
require 'hybrid_platforms_conductor/nodes_handler'
require 'hybrid_platforms_conductor/cmd_runner'
require 'optparse'

cmd_runner = HybridPlatformsConductor::CmdRunner.new
nodes_handler = HybridPlatformsConductor::NodesHandler.new
OptionParser.new do |opts|
  opts.banner = "Usage: #{$0} [options]"
  opts.separator ''
  opts.separator 'Main options:'
  opts.on('-h', '--help', 'Display help and exit') do
    puts opts
    exit 0
  end
  nodes_handler.options_parse(opts)
end.parse!
raise "Unknown options: #{ARGV.join(' ')}" unless ARGV.empty?

nodes_handler.platforms.each do |platform_handler|
  platform_handler.cmd_runner = cmd_runner
  platform_handler.setup
end
